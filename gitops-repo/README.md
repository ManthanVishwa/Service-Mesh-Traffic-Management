# GitOps Repository

This directory contains the GitOps configuration managed by ArgoCD.

## Structure

```
gitops-repo/
├── istio/           # Istio configurations (auto-generated by backend)
└── argocd/          # ArgoCD Application definitions
```

## Setup ArgoCD

### 1. Install ArgoCD

```bash
kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
```

### 2. Access ArgoCD UI

```bash
kubectl port-forward svc/argocd-server -n argocd 8080:443
```

Get admin password:

```bash
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d
```

Open: https://localhost:8080
Username: admin
Password: [from command above]

### 3. Configure Git Repository

In ArgoCD UI:

1. Go to Settings → Repositories
2. Connect your Git repository containing this `gitops-repo` folder
3. Provide credentials if private repository

### 4. Create ArgoCD Application

Apply the ArgoCD application manifest:

```bash
kubectl apply -f gitops-repo/argocd/mesh-dashboard-app.yaml
```

Or create via UI:

- Application Name: mesh-dashboard
- Project: default
- Repository URL: [your-repo-url]
- Path: gitops-repo/istio
- Cluster: in-cluster
- Namespace: mesh-dashboard

## How It Works

1. **User creates traffic rule** in the dashboard UI
2. **Backend API** generates Istio YAML configuration
3. **Backend commits** the YAML to `gitops-repo/istio/` directory
4. **ArgoCD detects** the Git change automatically
5. **ArgoCD applies** the new configuration to Kubernetes
6. **Istio updates** the traffic routing in real-time

## Manual Sync

If auto-sync is disabled, manually sync from ArgoCD:

```bash
argocd app sync mesh-dashboard
```

Or via UI: Click "Sync" button on the application.

## GitOps Best Practices

- ✅ All infrastructure changes go through Git
- ✅ Git history provides audit trail
- ✅ Easy rollback to previous configurations
- ✅ Declarative and version-controlled
- ✅ Automated synchronization

## Directory Contents

- `istio/` - Contains dynamically generated Istio VirtualServices and DestinationRules
- `argocd/` - Contains ArgoCD Application definitions
